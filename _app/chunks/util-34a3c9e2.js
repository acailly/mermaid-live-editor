var B=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var T=(e,t,o)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,f=(e,t)=>{for(var o in t||(t={}))$.call(t,o)&&T(e,o,t[o]);if(j)for(var o of j(t))ee.call(t,o)&&T(e,o,t[o]);return e},S=(e,t)=>Q(e,W(t));import{C as p,S as te,i as oe,s as ae,e as U,c as F,a as G,d as v,b as m,Z as g,f as se,E as re,P as R,I as ie,A as ne,ab as ce,ac as k,R as A,J as b,K as D,L as le,ad as ue,N as H}from"./vendor-df9de99c.js";import{c as h,e as I,f as C,i as de,h as fe,j as pe,a as me,k as ge}from"./state-24caa27d.js";const he=p(void 0);function ye(e){let t,o;return{c(){t=U("div"),o=U("div"),this.h()},l(r){t=F(r,"DIV",{id:!0,class:!0});var a=G(t);o=F(a,"DIV",{id:!0,class:!0}),G(o).forEach(v),a.forEach(v),this.h()},h(){m(o,"id","container"),m(o,"class","flex-1 overflow-auto"),m(t,"id","view"),m(t,"class","p-2 svelte-5ndy2s"),g(t,"error",e[2]),g(t,"outOfSync",e[3])},m(r,a){se(r,t,a),re(t,o),e[4](o),e[5](t)},p(r,[a]){a&4&&g(t,"error",r[2]),a&8&&g(t,"outOfSync",r[3])},i:R,o:R,d(r){r&&v(t),e[4](null),e[5](null)}}}function we(e,t,o){let r;ie(e,h,i=>o(9,r=i));let a="",u="",s,c,n=!1,l=!1,d=!0;ne(()=>{h.subscribe(i=>{try{if(s&&i&&(i.updateDiagram||i.autoSync)){if(i.autoSync||ce(h,r.updateDiagram=!1,r),o(3,l=!1),d=!0,a===i.code&&u===i.mermaid)return;a=i.code,u=i.mermaid;const _=c.parentElement.scrollTop;delete s.dataset.processed,k.initialize(Object.assign({},JSON.parse(i.mermaid))),k.render("graph-div",a,Y=>{o(0,s.innerHTML=Y,s),s.querySelectorAll(".node").forEach(function(N){N.onclick=function(){const Z=N.id.split("-")[1],L=prompt("Create a new node");L&&h.update(O=>{const x={code:O.code+`
${Z} --> ${L}`,updateEditor:!0,updateDiagram:!0};return f(f({},O),x)})}})}),o(1,c.parentElement.scrollTop=_,c),o(2,n=!1)}else d?d=!1:o(3,l=!0)}catch(_){console.log("view fail",_),o(2,n=!0)}}),he.subscribe(i=>{typeof i=="undefined"?o(2,n=!1):(o(2,n=!0),console.log("Error: ",i))})});function K(i){A[i?"unshift":"push"](()=>{s=i,o(0,s)})}function X(i){A[i?"unshift":"push"](()=>{c=i,o(1,c)})}return[s,c,n,l,K,X]}class Te extends te{constructor(t){super();oe(this,t,we,ye,ae,{})}}const _e=30,E=b(p("manual"),D(),"autoHistoryMode"),y=b(p([]),D(),"autoHistoryStore"),w=b(p([]),D(),"manualHistoryStore"),V=p([]),Ue=le([E,y,w,V],([e,t,o,r],a)=>{a(e==="auto"?t:e==="manual"?o:e==="loader"?r:t)}),Se=e=>{if(e.type==="loader"){V.update(t=>[e,...t]);return}if(e.name=ue(2),e.type!=="auto"){w.update(t=>[e,...t]);return}y.update(t=>(t.length===_e&&t.pop(),[e,...t]))},Fe=e=>{(H(E)==="auto"?y:w).update(t=>(H(E)!=="loader"&&(t=t.filter(o=>e&&o.time!=e)),t))},Ge=e=>{const t=H(e?y:w);return t.length>0?JSON.stringify(t[0].state):""},P="code.mmd",J="config.json",ve=e=>P in e,M=async e=>e.truncated?await(await fetch(e.raw_url)).text():e.content,be=async e=>{const[t,o,r,a]=e.split("github.com").pop().split("/"),{html_url:u,files:s,history:c}=await(await fetch(`https://api.github.com/gists/${r}${a?"/"+a:""}`)).json();if(ve(s)){const n=await M(s[P]);let l;J in s&&(l=await M(s[J]));const d=c[0];return{url:`${u}/${d.version}`,code:n,config:l,author:d.user.login,time:new Date(d.committed_at).getTime(),version:d.version.slice(-7)}}else throw"Invalid gist provided"},q=(e,t=e.url)=>{const o=S(f({},I),{code:e.code,loader:{type:"gist",config:{url:t}}});return e.config&&(o.mermaid=e.config),o},De=async e=>{try{const[t,o,r,a]=e.split("github.com").pop().split("/"),{history:u}=await(await fetch(`https://api.github.com/gists/${r}${a?"/"+a:""}`)).json(),s=[];for(const n of u){const l=await be(n.url).catch(()=>{});l&&s.push(l)}if(s.length===0)throw"Invalid gist provided";s.reverse();const c=q(s.slice(-1).pop(),e);for(const n of s)Se({state:q(n),time:n.time,type:"loader",url:n.url,name:`${n.author} v${n.version}`});return c}catch(t){console.error(t)}},z={gist:De},He=async()=>{const e=new URLSearchParams(window.location.search);let t=I,o,r,a=!1;const u=e.get("code"),s=e.get("config");if(u&&(o=await(await fetch(u)).text(),a=!0),s?r=await(await fetch(s)).text():r=I.mermaid,o)t={code:o,mermaid:r,loader:{type:"files",config:{codeURL:u,configURL:s}}};else for(const[c,n]of e.entries())if(c in z)try{t=await z[c](n),a=!0;break}catch(l){console.error(l)}a&&C(S(f({},t),{autoSync:!0,updateDiagram:!0,updateEditor:!0}))},Ie=()=>{ge(window.location.hash.slice(1))},Ee=()=>{C({updateDiagram:!0})},Re=async()=>{var e;Ie(),await de("Loading Gist...",He().catch(console.error)),Ee(),fe(),await pe(),(e=me)==null||e.page()};export{Te as V,Ue as a,Se as b,Fe as c,he as e,Ge as g,E as h,Re as i,V as l,Ee as s};
